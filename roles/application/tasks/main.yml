---
  - name: Create project directory
    file:
      path: /opt/claudinha/{{ item.dest }}
      state: directory
      owner: "{{ ansible_user }}"
      group: claudinha
      mode: 0775
    with_items:
      - { dest: 'module' }
      - { dest: 'backend' }
      - { dest: 'frontend' }

  - name: Download "claudinha-module" repository
    git:
      repo: https://github.com/claudinha-io/claudinha-module.git
      dest: /opt/claudinha/module/
      force: yes

  - name: Download "claudinha-backend" repository
    git:
      repo: https://github.com/claudinha-io/claudinha-backend.git
      dest: /opt/claudinha/backend/
      force: yes

  - name: Install "claudinha-module" python dependencies
    pip:
      requirements: /opt/claudinha/module/requirements.txt
      virtualenv_command: pip3
      virtualenv: /opt/claudinha/venv

  - name: Setup "claudinha" python module
    pip:
      name: /opt/claudinha/module
      # extra_args: '-e'   # this creates a link rather then copying the files
      virtualenv_command: pip3
      virtualenv: /opt/claudinha/venv

  - name: Clean "module" path
    file:
      state: absent
      path: "/opt/claudinha/module/"

  - name: Install "back-end" python dependencies
    pip:
      requirements: /opt/claudinha/backend/requirements.txt
      virtualenv_command: pip3
      virtualenv: /opt/claudinha/venv

  # - name: Restart Gunicorn
  #   supervisorctl:
  #     name: gunicorn
  #     state: restarted
  #     config: /etc/supervisor/supervisord.conf